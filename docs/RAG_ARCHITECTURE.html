<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture RAG - Bolkiri Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin: 30px 0 15px 0;
        }
        
        .workflow {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .workflow pre {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }
        
        .example {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .example h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        .check {
            color: #28a745;
            font-weight: bold;
        }
        
        .cross {
            color: #dc3545;
            font-weight: bold;
        }
        
        .phase {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .phase-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .key-point {
            background: #e7f3ff;
            border-left: 5px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .key-point strong {
            color: #1976D2;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #c7254e;
        }
        
        .highlight {
            background: #fffbcc;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        footer {
            background: #2d3748;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Architecture RAG Compl√®te</h1>
            <p>Retrieval Augmented Generation - Bolkiri Chatbot</p>
        </header>
        
        <div class="content">
            <!-- Introduction -->
            <div class="section">
                <h2>Principe Universel RAG</h2>
                <p><strong>Oui, le m√™me principe s'applique pour TOUTE question !</strong></p>
                <p>Le RAG (Retrieval Augmented Generation) suit toujours le m√™me workflow en 3 phases : Indexation ‚Üí Retrieval ‚Üí Generation</p>
            </div>

            <!-- Phase 1 : Indexation -->
            <div class="section">
                <h2>Phase 1 : INDEXATION (une seule fois au d√©marrage)</h2>
                
                <div class="workflow">
                    <pre>
Donn√©es brutes (JSON)
    ‚Üì
Chunking (d√©coupage en documents)
    ‚îú‚îÄ 20 restaurants ‚Üí 20 docs
    ‚îî‚îÄ 13 pages web ‚Üí 13 docs
    ‚Üì
G√©n√©ration embeddings (OpenAI)
    ‚îú‚îÄ Chaque doc ‚Üí vecteur 1536 dimensions
    ‚îî‚îÄ Batch de 20 docs √† la fois
    ‚Üì
Index FAISS (stockage vectoriel)
    ‚îî‚îÄ 34 vecteurs en RAM
    ‚Üì
Cache (pickle) pour r√©utilisation
                    </pre>
                </div>

                <div class="key-point">
                    <strong>‚ö° Performance :</strong> 
                    Premi√®re fois = ~30s (g√©n√©ration embeddings)<br>
                    Apr√®s cache = <5s (chargement instantan√©)
                </div>
            </div>

            <!-- Phase 2 : Query -->
            <div class="section">
                <h2>Phase 2 : QUERY (chaque question utilisateur)</h2>
                
                <div class="phase">
                    <h3><span class="phase-number">1</span>RETRIEVAL (R√©cup√©ration)</h3>
                    <ul>
                        <li>Question utilisateur ‚Üí Embedding vectoriel (1536 dimensions)</li>
                        <li>Recherche FAISS (similarit√© L2 - distance euclidienne)</li>
                        <li>Score chaque document selon distance vectorielle</li>
                        <li>Retourne Top-K r√©sultats (K=5 par d√©faut)</li>
                    </ul>
                </div>

                <div class="phase">
                    <h3><span class="phase-number">2</span>AUGMENTATION (Enrichissement)</h3>
                    <ul>
                        <li>Formater le contexte pertinent extrait</li>
                        <li>Ajouter m√©tadonn√©es (type de document, source, URL)</li>
                        <li>Limiter la taille totale (max 4000 tokens pour GPT)</li>
                    </ul>
                </div>

                <div class="phase">
                    <h3><span class="phase-number">3</span>GENERATION (R√©ponse)</h3>
                    <ul>
                        <li>Construire prompt : System + Contexte + Question</li>
                        <li>GPT-4o-mini g√©n√®re la r√©ponse</li>
                        <li>R√©ponse bas√©e <strong>UNIQUEMENT</strong> sur le contexte fourni</li>
                    </ul>
                </div>
            </div>

            <!-- Exemples concrets -->
            <div class="section">
                <h2>üìù Exemples Concrets</h2>
                
                <div class="example">
                    <h4>Question 1 : "vous √™tes pr√©sents dans le 78 ?"</h4>
                    <div class="workflow">
                        <pre>
Embedding question: [0.023, -0.15, 0.08, ...]
    ‚Üì Similarit√© FAISS
Top r√©sultat:
  - Doc: "Restaurant Les Mureaux 78130..."
  - Score: 0.78 (78% similaire)
    ‚Üì
Contexte: "Restaurant BOLKIRI Les Mureaux
           Situ√© √† 120 Avenue Paul Raoult, 78130 Les Mureaux
           T√©l: +33 1 30 99 48 48"
    ‚Üì GPT-4o-mini
R√©ponse: "Oui, nous avons un restaurant √† Les Mureaux (78130)"
                        </pre>
                    </div>
                </div>

                <div class="example">
                    <h4>Question 2 : "menu v√©g√©tarien ?"</h4>
                    <div class="workflow">
                        <pre>
Embedding question: [0.12, -0.04, 0.31, ...]
    ‚Üì Similarit√© FAISS
Top r√©sultats:
  - Page menu (score: 0.73)
  - Restaurants (score: 0.68)
    ‚Üì
Contexte: "FORMULE STREET BANH MI
           Options v√©g√©tariennes disponibles..."
    ‚Üì GPT-4o-mini
R√©ponse: "Nos options v√©g√©tariennes incluent..."
                        </pre>
                    </div>
                </div>

                <div class="example">
                    <h4>Question 3 : "horaires Bondy"</h4>
                    <div class="workflow">
                        <pre>
Embedding question: [0.08, -0.21, 0.15, ...]
    ‚Üì Similarit√© FAISS
Top r√©sultat:
  - Restaurant Bondy (score: 0.81)
    ‚Üì
Contexte: "Restaurant Bondy
           Horaires: Lun-Dim 11h-22h..."
    ‚Üì GPT-4o-mini
R√©ponse: "Le restaurant de Bondy est ouvert..."
                        </pre>
                    </div>
                </div>
            </div>

            <!-- Points cl√©s -->
            <div class="section">
                <h2>üéØ Points Cl√©s RAG</h2>
                
                <h3>1. S√©mantique vs Mot-cl√©</h3>
                <div class="key-point">
                    <strong class="cross">‚ùå Recherche mot-cl√© :</strong> "78" trouve SEULEMENT "78"<br>
                    <strong class="check">‚úÖ RAG s√©mantique :</strong> "78" trouve "Yvelines", "78130", "d√©partement soixante-dix-huit", "proche Paris ouest"
                </div>

                <h3>2. Top-K (nombre de r√©sultats)</h3>
                <ul>
                    <li>Question simple ‚Üí K=3 suffit</li>
                    <li>Question complexe ‚Üí K=10 pour plus de contexte</li>
                    <li><strong>Bolkiri : K=5 par d√©faut</strong> (√©quilibr√©)</li>
                </ul>

                <h3>3. Scoring (calcul de pertinence)</h3>
                <div class="workflow">
                    <pre>
# Distance L2 (FAISS)
distance = 0.442      # Plus petit = plus similaire
score = 1 / (1 + distance)  # 0.693 (69% pertinent)

Interpr√©tation:
  > 0.8 : Tr√®s pertinent
  0.6-0.8 : Pertinent
  0.4-0.6 : Moyennement pertinent
  < 0.4 : Peu pertinent
                    </pre>
                </div>

                <h3>4. Fallback (gestion des √©checs)</h3>
                <ul>
                    <li><strong>Aucun r√©sultat :</strong> "Je n'ai pas cette information"</li>
                    <li><strong>Score < 0.5 :</strong> "Pas s√ªr, voici ce que j'ai trouv√©..."</li>
                    <li><strong>Erreur technique :</strong> Message d'erreur explicite</li>
                </ul>

                <h3>5. Cache Embeddings</h3>
                <div class="key-point">
                    <strong>üí∞ Co√ªt :</strong><br>
                    ‚Ä¢ R√©g√©n√©rer = co√ªt API OpenAI (~$0.0001 √ó 34 docs = $0.0034)<br>
                    ‚Ä¢ Cache = gratuit + instantan√©<br>
                    ‚Ä¢ Invalidation : si JSON change (hash MD5 diff√©rent)
                </div>
            </div>

            <!-- Comparaison -->
            <div class="section">
                <h2>‚öñÔ∏è Avantages vs Syst√®me Classique</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>Crit√®re</th>
                            <th>Sans RAG</th>
                            <th>Avec RAG</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Recherche "78"</strong></td>
                            <td class="cross">‚ùå Rien trouv√©</td>
                            <td class="check">‚úÖ Les Mureaux (78130)</td>
                        </tr>
                        <tr>
                            <td><strong>Recherche "pr√®s de Paris"</strong></td>
                            <td class="cross">‚ùå Rien trouv√©</td>
                            <td class="check">‚úÖ Paris 11, Nanterre, Montreuil...</td>
                        </tr>
                        <tr>
                            <td><strong>Synonymes</strong></td>
                            <td class="cross">‚ùå Non support√©</td>
                            <td class="check">‚úÖ Oui (ville = localisation = adresse)</td>
                        </tr>
                        <tr>
                            <td><strong>Scalabilit√©</strong></td>
                            <td class="cross">‚ùå ~100 documents max</td>
                            <td class="check">‚úÖ Millions de documents possibles</td>
                        </tr>
                        <tr>
                            <td><strong>Maintenance</strong></td>
                            <td class="cross">‚ùå R√®gles manuelles √† coder</td>
                            <td class="check">‚úÖ Automatique</td>
                        </tr>
                        <tr>
                            <td><strong>Performance recherche</strong></td>
                            <td>~200ms (regex)</td>
                            <td>~5ms (FAISS)</td>
                        </tr>
                        <tr>
                            <td><strong>Co√ªt</strong></td>
                            <td>Gratuit</td>
                            <td>~$0.01 par 1000 questions</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Architecture technique -->
            <div class="section">
                <h2>üèóÔ∏è Architecture Technique Bolkiri</h2>
                
                <h3>Stack Technologique</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Composant</th>
                            <th>Technologie</th>
                            <th>R√¥le</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Vector Store</strong></td>
                            <td>FAISS (Facebook AI)</td>
                            <td>Index vectoriel en m√©moire RAM</td>
                        </tr>
                        <tr>
                            <td><strong>Embeddings</strong></td>
                            <td>OpenAI text-embedding-ada-002</td>
                            <td>Conversion texte ‚Üí vecteur 1536D</td>
                        </tr>
                        <tr>
                            <td><strong>LLM</strong></td>
                            <td>GPT-4o-mini</td>
                            <td>G√©n√©ration de r√©ponses</td>
                        </tr>
                        <tr>
                            <td><strong>Cache</strong></td>
                            <td>Pickle (Python)</td>
                            <td>Sauvegarde embeddings (~500KB)</td>
                        </tr>
                        <tr>
                            <td><strong>Data Source</strong></td>
                            <td>JSON</td>
                            <td>20 restaurants + 13 pages web</td>
                        </tr>
                    </tbody>
                </table>

                <h3>M√©triques de Performance</h3>
                <ul>
                    <li><strong>Temps indexation initiale :</strong> ~30 secondes</li>
                    <li><strong>Temps chargement cache :</strong> <5 secondes</li>
                    <li><strong>Latence recherche FAISS :</strong> ~5ms</li>
                    <li><strong>Latence embedding question :</strong> ~100ms</li>
                    <li><strong>Latence GPT g√©n√©ration :</strong> ~500ms</li>
                    <li><strong>Latence totale moyenne :</strong> ~600-800ms</li>
                    <li><strong>M√©moire RAM utilis√©e :</strong> ~50-100MB</li>
                </ul>
            </div>

            <!-- Workflow complet -->
            <div class="section">
                <h2>üîÑ Workflow Complet (Question ‚Üí R√©ponse)</h2>
                
                <div class="workflow">
                    <pre>
[USER] "Vous √™tes pr√©sents dans le 78 ?"
    ‚Üì
[API] POST /chat {"message": "..."}
    ‚Üì
[AI_AGENT] chat()
    ‚îú‚îÄ plan_and_execute()
    ‚îÇ   ‚îú‚îÄ GPT-4o-mini : "besoin info localisation"
    ‚îÇ   ‚îî‚îÄ D√©cision : tool "search_knowledge"
    ‚îÇ
    ‚îú‚îÄ search_knowledge("78")
    ‚îÇ   ‚îî‚îÄ kb.search("78", limit=5)
    ‚îÇ       ‚îî‚îÄ rag_engine.search("78", top_k=5)
    ‚îÇ           ‚îú‚îÄ Embedding "78" ‚Üí [0.023, -0.15, ...]
    ‚îÇ           ‚îú‚îÄ FAISS.search() ‚Üí distances + indices
    ‚îÇ           ‚îú‚îÄ Top 5 r√©sultats tri√©s par score
    ‚îÇ           ‚îî‚îÄ Return formatted results
    ‚îÇ
    ‚îú‚îÄ Contexte format√© retourn√©
    ‚îÇ   "Restaurant BOLKIRI Les Mureaux
    ‚îÇ    Situ√© √† 120 Avenue Paul Raoult, 78130
    ‚îÇ    T√©l: +33 1 30 99 48 48"
    ‚îÇ
    ‚îî‚îÄ GPT-4o-mini.chat()
        ‚îú‚îÄ System prompt
        ‚îú‚îÄ Contexte RAG
        ‚îú‚îÄ Question utilisateur
        ‚îî‚îÄ G√©n√©ration r√©ponse
            ‚Üì
[RESPONSE] "Oui, nous avons un restaurant √† Les Mureaux (78130)"
    ‚Üì
[USER] Re√ßoit la r√©ponse
                    </pre>
                </div>
            </div>

            <!-- Conclusion -->
            <div class="section">
                <h2>üí° En R√©sum√©</h2>
                
                <div class="key-point">
                    <strong>Le RAG = Google pour votre base de connaissances</strong>
                    <p style="margin-top: 10px;">
                        Au lieu de chercher des mots-cl√©s exacts, le RAG comprend le <em>sens</em> de la question 
                        et trouve les informations les plus <em>pertinentes s√©mantiquement</em>, 
                        m√™me si les mots exacts ne correspondent pas.
                    </p>
                </div>

                <h3>Pourquoi c'est r√©volutionnaire :</h3>
                <ul>
                    <li>‚úÖ <strong>Comprend l'intention</strong> : "78" = "Yvelines" = "proche Paris ouest"</li>
                    <li>‚úÖ <strong>Scalable</strong> : Fonctionne avec 10 ou 10 millions de documents</li>
                    <li>‚úÖ <strong>Automatique</strong> : Pas de r√®gles √† coder manuellement</li>
                    <li>‚úÖ <strong>Pr√©cis</strong> : Seules les infos pertinentes sont utilis√©es</li>
                    <li>‚úÖ <strong>Rapide</strong> : R√©ponse en <1 seconde</li>
                </ul>

                <h3>Prochaines optimisations possibles :</h3>
                <ul>
                    <li>üîπ Augmenter Top-K pour questions complexes</li>
                    <li>üîπ Impl√©menter reranking (rescorer les r√©sultats)</li>
                    <li>üîπ Ajouter filtres m√©tadonn√©es (ville, cat√©gorie...)</li>
                    <li>üîπ Hybrid search (RAG + mots-cl√©s)</li>
                    <li>üîπ Monitoring des scores pour am√©lioration continue</li>
                </ul>
            </div>
        </div>

        <footer>
            <p><strong>Bolkiri Chatbot</strong> - Architecture RAG Enterprise-Grade</p>
            <p style="margin-top: 10px; opacity: 0.8;">
                FAISS + OpenAI Embeddings + GPT-4o-mini | Novembre 2025
            </p>
        </footer>
    </div>
</body>
</html>